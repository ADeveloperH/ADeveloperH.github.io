---
layout: post
title: Gradle 知识点相关
categories: 开发工具总结
---

### 1、gradle简介 ###
Gradle 是以 Groovy 语言为基础, 基于DSL (领域特定语言) 语法的自动化构建工具,但是它增加了一些额外的特性,这使得Gradle更加的容易去阐释构建.
一个构建脚本能够包含任何Groovy语言的元素 ( Any language element except for statement labels ), 每个构建脚本都使用UTF-8编码.

### 2、环境配置 ###

### 3、名词解释 ###


### 4、命令相关 ###

#### 4.1 区别gradle命令和gradlew命令 ####  

- 定义区别：Gradlew是包装器，自动下载包装器里定义好的gradle 版本，保证编译环境统一，gradle 是用本地的gradle版本。对于gradlew，其在Android studio的指定是在gradle/wrapper/gradle-wrapper.properties 中完成的；
- 存放路径不同：对于系统gradle其存放在 ~/.gradle 下面(如果配置了环境变量就在环境变量的目录下)。对于gradlew其存放在 ～/.gradlew/wrapper/dists 下面。这个下面有着许多版本的gradle。这些就是gradlew下载下来的gradle版本；
- 使用gradle版本不同：若你在命令行使用gradlew那么你使用的是存放在～/.gradlew/wrapper/dists路径下面的,通过在gradle/wrapper/gradle-wrapper.properties文件指定的gradle脚本。而你若使用gradle命令行，那么你使用的是~/.gradle下面的gradle脚本。通过命令行gradle -v 和gradlew -v 可以查看两者的版本具体信息差异。

#### 4.2 gradle 文件介绍 ####

- 工程Project 中的 build.gradle : 工程控制Gradle编译配置
- 模块module中的 build.gradle  ： 控制每个Module的编译过程
- gradle.properties : gradle动态参数的配置文件
- local.properties ： 本地的配置，如：SDK位置
- gradle-wrapper.properties ：gradle本地代理，声明了指向目录和版本
- distributionUrl : 指定gradle版本不存在时，就从Value的地址中去下载。很多时候，我们只要版本换成我们本地存在的gradle版本就可以了


settings.gradle ： 配置Gradle中的Module管理

- Project:build.gradle是用来配置项目的构建任务.默认的build.gradle内容如下:
```java
//项目构建文件，你可以到各子项目/模块添加常用的配置选项.
buildscript	{
//Android插件从这个仓库中下载
repositories	{
jcenter()	//	依赖仓库源的别名,兼容maven的远程中央仓库
}
//依赖
dependencies	{
//	android	gradle插件
classpath	'com.android.tools.build:gradle:2.2.0-alpha1'
//	提示:
//请不要在此处添加应用程序依赖;它们应该在单个Module(模块)build.gradle文件
//这里添加的应该只是Project的依赖
}
}
//此处配置Project中默认的仓库源,包括每个module的依赖
//这样每个module就不用单独配置仓库了
allprojects	{
	repositories	{
	jcenter()
	}
}
//buildscript中的repositories是指定Android插件的仓库源.
//allprojects中的repositories是指定整个Project中默认的仓库源.
//	任务类型是	Delete
//	clean任务就是删除项目根目录下的build目录(build为输出目录)
task	clean(type:	Delete)	{
	delete	rootProject.buildDir
}
//	打包前执行clean任务
```

- 模块构建配置文件:build.gradle.Module:build.gradle是用来配置模块的构建任务.默认的build.gradle文件内容如下:
```java
//插件:
//这个module是一个android程序,使用com.android.application
//如果是android库,应该使用com.android.library
apply	plugin:	'com.android.application'
android	{//android程序构建需要配置的参数
//编译使用的SDK版本
compileSdkVersion	23
//buildtool版本
buildToolsVersion	"23.0.2"
defaultConfig	{//默认配置
applicationId	"com.wirelessqa.basebuildsample"	//apk包名
//最小SDK版本
minSdkVersion	16
//目标SDK版本
targetSdkVersion	23
//version	code
versionCode	1
//应用程序的版本
versionName	"1.0"
//android单元测试test	runner
testInstrumentationRunner	"android.support.test.runner.AndroidJUnitRunner"
}
//构建类型,	此处配置debug和release版本的一些参数,像混淆、签名配置.
buildTypes	{
//release版本的配置
release	{
//是否开启混淆
minifyEnabled	false
//指定混淆文件及混淆规则配置文件的位置
proguardFiles	getDefaultProguardFile('proguard-android.txt'),	'proguard-rules.pro'
	}
	}
}
//模块依赖
dependencies	{
//编译依赖libs目录下所有jar包
compile	fileTree(dir:	'libs',	include:	['*.jar'])
//编译依赖appcompat库
compile	'com.android.support:appcompat-v7:23.4.0'
}
```
模块构建配置文件:build.gradle也可以在项目结构中配置
#### 4.3 常用命令 ####

- 查看当前项目支持哪些Gradle任务：gradlew	task
```java
------------------------------------------------------------
All	tasks	runnable	from	root	project(所有从项目根目录可运行的任务)
------------------------------------------------------------
Android	tasks(Android	任务)
-------------
androidDependencies	-	显示项目的Android依赖
signingReport	-	显示每个变种版本的签名信息.
sourceSets	-	打印出所有在这个项目中定义的source集合.
Build	tasks(构建任务)
-----------
assemble	-	编译并打出应用程序所有变种版本的包.
assembleAndroidTest	-编译并打出所有测试应用的包.
assembleDebug	-	编译并打出Debug版本的包.
assembleRelease	-	编译并打出Release版本的包.
build	-	执行所有检查并编译打包
buildDependents	-	检查所有的依赖并编译打包.
buildNeeded	-	检查所有的依赖并编译打包.
clean	-	删除构建目录
查看和执行Gradle任务
259compileDebugAndroidTestSources
compileDebugSources
compileDebugUnitTestSources
compileReleaseSources
compileReleaseUnitTestSources
mockableAndroidJar	-	创建一个适用于单元测试的android.jar版本.
Build	Setup	tasks	(构建设置任务)
-----------------
init	-	被始化一个新的Gradle构建.
wrapper	-	生成	Gradle	wrapper文件
Help	tasks(帮助任务)
----------
buildEnvironment	-	显示项目根目录中声明的所有构建脚本的依赖
components	-	显示项目根目录产生的组件
dependencies	-	显示项目根目录中所有依赖的声明.
dependencyInsight	-	显示并洞察项目根目录中一个特殊的依赖关系.
help	-	显示帮助信息
model	-	显示项目根目录的配置模型.
projects	-	显示项目根目录中的子项目.
properties	-	显示项目根目录的属性.
tasks	-	显示从项目根目录可以运行的任务(
有些显示的任务可能属于子项目)
Install	tasks(安装任务)
-------------
installDebug	-	编译打包并安装Debug版本的包.
installDebugAndroidTest	-	编译打包并安装Debug版本的测试包到设备上
查看和执行Gradle任务
260uninstallAll	-	卸载所有版本的包.
uninstallDebug	-	卸载Debug版本的包.
uninstallDebugAndroidTest	-	从设备上卸载Debug版本的Android测试包
uninstallRelease	-	卸载Release版本的包.
Verification	tasks(验证任务)
------------------
check	-	运行所有检查.
connectedAndroidTest	-	在已连接的设备上安装所有flavors(渠道包)并运行instrumentation测试
connectedCheck	-	在当前已连接的设备上运行设备检测.
connectedDebugAndroidTest	-	在已连接的设备上安装并运行Debug版本的测试.
deviceAndroidTest	-	在所有提供的设备上安装并运行instrumentation测试.
deviceCheck	-	在所有提供的设备和测试服务器上运行设备检测.
lint	-	在所有变种版本上运行lint检测.
lintDebug	-	在Debug版本上运行lint检测.
lintRelease	-	在Release版本上运行lint检测.
test	-	在所有变种版本上运行单元测试.
testDebugUnitTest	-	在Debug版本上运行单元测试.
testReleaseUnitTest	-	在Release版本上运行单元测试.
Other	tasks	(其它任务)
-----------
jarDebugClasses
jarReleaseClasses
transformResourcesWithMergeJavaResForDebugUnitTest
transformResourcesWithMergeJavaResForReleaseUnitTest
想查看所有任务和更多详情,	请运行gradlew	tasks	--all
想查看一个任务的更多详情,	请运行gradlew	help	--task	<task>
BUILD	SUCCESSFUL
查看和执行Gradle任务
261Total	time:	6.717	secs
这个构建可以更快,	请考虑使用Gradle守护:	https://docs.gradle.org/2.10/userguide/gradle_daemo
n.html
```
- 执行Gradle任务
```java
执行命令:
gradle	+	任务名称或.\/gradlew	+	任务名称
注意:Gradle的Android插件提供了四个顶级任务:打包(assemble)、检测(check)、构建
(build)、清理(clean),当我们执行一个顶级任务的时候会同时执行与其依赖的任务.
比如你执行:	.\/gradlew	assemble
它会把你配置的所有构建类型(Build	Types)全部打出来,默认的构建类型是Debug和Relea
因此最起码它会执行两个任务:
gradlew	assembleDebug
gradlew	assembleRelease
如果有其它的构建类型,任务名应该是:
gradlew	assemble+构建类型名
另外,执行构建(build)任务会执行检测(check)和打包(assemble)任务.
```
- 常用命令
```java

查看gradle版本 ./gradlew -v

检查任务 ./gradlew check

编译并打出Debug版本的包   ./gradlew assembleDebug

编译并打出Release版本的包 ./gradlew assembleRelease

导出指定渠道测试包，同时携带异常信息 ./gradlew assembleBaiduDebug --stacktrace

执行检查并编译打包（执行了 check和assemble,打出所有Release和Debug的包.） ./gradlew build

清除所有中间编译结果,删除build目录（会把app下面的build目录删掉） ./gradlew clean

编译打包并安装Debug版本的包 ./gradlew installDebug

卸载Debug版本的包 ./gradlew uninstallDebug

立即停止编译 ./gradlew --stop

使用-info查看任务详情 ./gradlew uninstallDebug	-info




```

#### 4.4 Build Variant 相关 ####



### 5 常见问题 ###

#### 5.1 '/gradlew' 不是内部或外部命令，也不是可运行的程序或批处理文件。####

解决方案：查看项目目录下是否确实gradlew.bat文件，如果缺少把别的项目的copy一份过来运行命令gradlw -v下载对应版本后即可执行相关命令。

[该为你的Android Studio 打造一个炫酷的个性化主题了](https://juejin.im/post/58ea37ae0ce46300586427b6)  
